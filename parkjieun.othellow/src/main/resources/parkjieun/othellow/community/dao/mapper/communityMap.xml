<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="parkjieun.othellow.community.dao.mapper.CommunityMapper">
	<select id="communityList" resultType="community">
		select c.sort, c.seq, c.title, u.user_rank userRank, u.user_nickname userNickname, c.reg_date regDate, c.hit_count hitCount
		from users u join community c
		on u.user_id = c.user_id
		order by c.seq desc
	</select>
	
	<select id="informList" resultType="community">
		select c.sort, c.seq, c.title, u.user_rank userRank, u.user_nickname userNickname, c.reg_date regDate, c.hit_count hitCount
		from users u join community c
		on u.user_id = c.user_id
		where c.sort='공지'
		order by c.seq desc
	</select>
	
	<select id="chatList" resultType="community">
		select c.sort, c.seq, c.title, u.user_rank userRank, u.user_nickname userNickname, c.reg_date regDate, c.hit_count hitCount
		from users u join community c
		on u.user_id = c.user_id
		where c.sort='잡담'
		order by c.seq desc
	</select>
	
	<select id="artList" resultType="community">
		select c.sort, c.seq, c.title, u.user_rank userRank, u.user_nickname userNickname, c.reg_date regDate, c.hit_count hitCount
		from users u join community c
		on u.user_id = c.user_id
		where c.sort='팬아트'
		order by c.seq desc
	</select>


	<!-- 총 게시글 갯수 출력 -->
	<select id="countPost" resultType="int">
		SELECT COUNT(*) FROM Community
	</select>

	<!-- 페이징 처리 후 게시글 조회 -->
	<select id="selectPost" resultType="community">
		SELECT * FROM (
			SELECT ROWNUM RN, A.* FROM (
				SELECT * FROM Community
				ORDER BY SEQ DESC
			) A
		)
		WHERE RN BETWEEN #{start} AND #{end}
	</select>
	
	
	<select id="read" parameterType="int" resultType="community">
	<![CDATA[
		select c.sort, c.title, c.reg_date regDate, c.hit_count hitCount, c.like_count likeCount, u.user_rank userRank, u.user_nickname userNickname, c.contents, i.image_link imageLink
		from users u, community c, character i
		where u.user_id = c.user_id
		and u.character_no = i.character_no and seq = #{seq}
		]]>
	</select>
	
	<update id="hitCountUpdate" parameterType="int" >
		update community set hit_count=hit_count+1
		where seq=#{seq}
	</update>
	
	<insert id="addPost">
		insert into community(seq, sort, title, contents, image, user_id, reg_date) values (seq_board.nextval, #{sort}, #{title}, #{contents}, #{image}, #{user_id), SYSDATE)
	</insert>
	
	<insert id="insertSelectKey">
		<selectKey keyProperty="seq" order="BEFORE" resultType="int">
			select seq_board.nextval from dual
		</selectKey>
			insert into community(seq, sort, title, contents, user_id, reg_date)
			values(#{seq}, #{sort}, #{title}, #{contents}, #{userId}, SYSDATE)
	</insert>
	
	<update id="updatePost" parameterType="community">
		update community
		set title=#{title}, contents=#{contents}, image=#{image}
		where seq=#{seq}
	</update>
	
	<delete id="delPost" parameterType="int">
		delete community where seq=#{seq}
	</delete>
	
	
</mapper>